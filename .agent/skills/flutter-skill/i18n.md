# Flutter i18n (Internationalization) Reference

Flutter 다국어 지원 가이드입니다.

## Table of Contents

- [Overview](#overview)
- [Setup](#setup)
- [ARB File Structure](#arb-file-structure)
- [Usage Patterns](#usage-patterns)
- [Best Practices](#best-practices)

---

## Overview

Flutter의 공식 다국어 지원 방식을 사용합니다. ARB (Application Resource Bundle) 파일을 통해 번역을 관리합니다.

### 주요 특징

| 특징 | 설명 |
|------|------|
| 하드코딩 금지 | 모든 텍스트는 반드시 다국어로 i18n 처리 |
| ARB 파일 위치 | `lib/l10n/*.arb` 파일에서 번역 관리 |
| 사용법 예시 | `T.key` 또는 `Lo.of(context)!.key` 로 사용 |

---

## Setup

### pubspec.yaml 설정

```yaml
dependencies:
  flutter:
    sdk: flutter
  flutter_localizations:
    sdk: flutter
  intl: any

flutter:
  generate: true
```

### l10n.yaml 설정

프로젝트 루트에 `l10n.yaml` 파일 생성:

```yaml
arb-dir: lib/l10n
template-arb-file: app_en.arb
output-localization-file: app_localizations.dart
output-class: Lo
```

### MaterialApp 설정

```dart
import 'package:flutter_localizations/flutter_localizations.dart';
import 'package:philgo/l10n/app_localizations.dart';

MaterialApp(
  localizationsDelegates: const [
    Lo.delegate,
    GlobalMaterialLocalizations.delegate,
    GlobalWidgetsLocalizations.delegate,
    GlobalCupertinoLocalizations.delegate,
  ],
  supportedLocales: const [
    Locale('en'),
    Locale('ko'),
  ],
  locale: const Locale('ko'),  // 기본 언어
)
```

---

## ARB File Structure

### 파일 구조

```
lib/
└── l10n/
    ├── app_en.arb      # 영어 (템플릿)
    ├── app_ko.arb      # 한국어
    └── app_localizations.dart  # 자동 생성
```

### ARB 파일 형식

**app_en.arb (템플릿):**

```json
{
  "@@locale": "en",
  "appTitle": "My App",
  "@appTitle": {
    "description": "The title of the application"
  },
  "hello": "Hello",
  "welcome": "Welcome, {name}!",
  "@welcome": {
    "description": "Welcome message with user name",
    "placeholders": {
      "name": {
        "type": "String",
        "example": "John"
      }
    }
  },
  "itemCount": "{count, plural, =0{No items} =1{1 item} other{{count} items}}",
  "@itemCount": {
    "description": "Number of items",
    "placeholders": {
      "count": {
        "type": "int"
      }
    }
  }
}
```

**app_ko.arb:**

```json
{
  "@@locale": "ko",
  "appTitle": "내 앱",
  "hello": "안녕하세요",
  "welcome": "환영합니다, {name}님!",
  "itemCount": "{count, plural, =0{항목 없음} =1{1개 항목} other{{count}개 항목}}"
}
```

### 코드 생성

ARB 파일 수정 후 자동 생성 실행:

```bash
flutter gen-l10n
```

---

## Usage Patterns

### 방법 1: Lo.of(context)

표준 `AppLocalizations` 인스턴스를 통해 사용합니다.

```dart
import 'package:philgo/l10n/app_localizations.dart';

@override
Widget build(BuildContext context) {
  return Text(Lo.of(context)!.hello);
}
```

### 방법 2: T 전역변수 (권장)

전역적 getter를 정의하여 간편하게 사용합니다.

**정의 (한 번만 설정):**

```dart
// lib/l10n/t.dart
import 'package:flutter/material.dart';
import 'app_localizations.dart';

late BuildContext _context;

void initT(BuildContext context) {
  _context = context;
}

Lo get T => Lo.of(_context)!;
```

**사용:**

```dart
// 앱 시작 시 초기화
initT(context);

// 사용
Text(T.hello)
Text(T.welcome('홍길동'))
Text(T.itemCount(5))
```

### 현재 언어 확인하는 방법

현재 적용 중인 Locale은 `Localizations.localeOf(context)`로 얻습니다. `initState()`에서는 아직 `Localizations`가 준비되지 않을 수 있으니, 프레임 이후에 접근하도록 `Timer.run` 또는 `WidgetsBinding.instance.addPostFrameCallback`을 사용합니다.

```dart
void initState() {
  super.initState();

  Timer.run(() {
    final Locale locale = Localizations.localeOf(globalContext);
    final languageCode = locale.languageCode;
    print(languageCode);
  });
}
```

`Locale`에는 `languageCode`와 `countryCode`가 있으며, 필요하면 `toLanguageTag()`로 전체 태그를 확인할 수 있습니다.

### 플레이스홀더 사용

```dart
// ARB 파일
// "greeting": "Hello, {name}! You have {count} messages."

// 사용
Text(T.greeting(name: '홍길동', count: 3))
```

### 복수형 (Plural)

```dart
// ARB 파일
// "itemCount": "{count, plural, =0{No items} =1{1 item} other{{count} items}}"

// 사용
Text(T.itemCount(0))   // "No items"
Text(T.itemCount(1))   // "1 item"
Text(T.itemCount(5))   // "5 items"
```

### 선택형 (Select)

```dart
// ARB 파일
// "gender": "{gender, select, male{He} female{She} other{They}}"

// 사용
Text(T.gender('male'))    // "He"
Text(T.gender('female'))  // "She"
```

---

## Best Practices

### 1. 하드코딩 금지 필수

```dart
// 잘못된 방법
Text('로그인')
Text('환영합니다')
showSnackBar(SnackBar(content: Text('저장되었습니다')))

// 올바른 방법
Text(T.login)
Text(T.welcome)
showComicSuccessSnackBar(context, T.saved)
```

### 2. 키 이름 규칙

```json
{
  // 화면/기능별 접두사 사용
  "loginTitle": "로그인",
  "loginEmail": "이메일",
  "loginPassword": "비밀번호",
  "loginButton": "로그인",
  "loginForgotPassword": "비밀번호를 잊으셨나요?",

  // 공통 액션
  "actionSave": "저장",
  "actionCancel": "취소",
  "actionDelete": "삭제",
  "actionEdit": "수정",

  // 공통 메시지
  "errorRequired": "필수 항목입니다",
  "errorInvalidEmail": "유효한 이메일을 입력하세요",
  "errorNetwork": "네트워크 연결을 확인해주세요"
}
```

### 3. 설명 추가

```json
{
  "welcomeMessage": "Welcome back, {name}!",
  "@welcomeMessage": {
    "description": "Greeting shown on home screen after user logs in",
    "placeholders": {
      "name": {
        "type": "String",
        "example": "John"
      }
    }
  }
}
```

### 4. 비동기에서 사용 (글로벌 키 필요)

```dart
// 전역적 GlobalKey로 context 접근
final context = globalNavigatorKey.currentContext!;
final message = Lo.of(context)!.errorNetwork;
```

### 5. 새 번역 추가 워크플로우

1. `app_en.arb` (템플릿)에 새 키 추가
2. `app_ko.arb` 등 다른 언어 파일에 번역 추가
3. `flutter gen-l10n` 실행
4. 코드에서 `T.newKey` 사용

---

## Common Translations Reference

### 액션 버튼

| 키 | 영어 | 한국어 |
|---|------|--------|
| `save` | Save | 저장 |
| `cancel` | Cancel | 취소 |
| `delete` | Delete | 삭제 |
| `edit` | Edit | 수정 |
| `confirm` | Confirm | 확인 |
| `close` | Close | 닫기 |
| `submit` | Submit | 제출 |
| `next` | Next | 다음 |
| `back` | Back | 이전 |

### 인증

| 키 | 영어 | 한국어 |
|---|------|--------|
| `login` | Login | 로그인 |
| `logout` | Logout | 로그아웃 |
| `signUp` | Sign Up | 회원가입 |
| `email` | Email | 이메일 |
| `password` | Password | 비밀번호 |

### 공통 메시지

| 키 | 영어 | 한국어 |
|---|------|--------|
| `loading` | Loading... | 로딩 중... |
| `success` | Success | 성공 |
| `error` | Error | 오류 |
| `noData` | No data | 데이터 없음 |

---

## Quick Reference

| 작업 | 명령어/코드 |
|------|------------|
| 코드 생성 | `flutter gen-l10n` |
| 번역 사용 | `T.keyName` 또는 `Lo.of(context)!.keyName` |
| 플레이스홀더 | `T.welcome(name: '홍길동')` |
| 복수형 | `T.itemCount(count)` |
| 파일 구조 | `lib/l10n/app_*.arb` |

## References

- [Flutter Internationalization](https://docs.flutter.dev/ui/accessibility-and-internationalization/internationalization)
- [intl package](https://pub.dev/packages/intl)
